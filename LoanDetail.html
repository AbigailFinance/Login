<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loan Details</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Lato:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --navy: #022449;
      --teal: #055f79;
      --light: #ecebe8;
      --gold: #d99623;
      --white: #ffffff;
    }

    body {
      background-color: var(--light);
      font-family: 'Lato', sans-serif;
      color: var(--navy);
    }

    h1, h2, h3, h4 {
      font-family: 'Montserrat', sans-serif;
    }

    .dashboard-card {
      background: var(--white);
      border-radius: 1rem;
      padding: 1.75rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    /* Stage Tracker */
    .stage-step {
      cursor: pointer;
      padding: 0.75rem;
      border-radius: 2rem;
      text-align: center;
      font-weight: 600;
      background: #dee2e6;
      color: #495057;
    }

    .stage-step.active {
      background: var(--gold);
      color: white;
    }

    .stage-step.completed {
      background: #198754;
      color: white;
    }

    /* Checklist */
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }

    .checklist-item:last-child {
      border-bottom: none;
    }

    /* Stage Dropdown */
    .stage-dropdown {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #f8f9fa;
      border-radius: 2rem;
      padding: 0.35rem 0.75rem;
      border: 1px solid #dee2e6;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .stage-dropdown i {
      color: var(--gold);
      font-size: 1.1rem;
    }

    .stage-select {
      border: none;
      background: transparent;
      font-weight: 600;
      color: var(--navy);
      padding-right: 1.75rem;
      min-width: 160px;
    }

    .stage-select:focus {
      box-shadow: none;
      outline: none;
    }

    .stage-select option {
      font-weight: 500;
    }

    .ellipsis-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--navy);
    }

    .navbar {
      background-color: var(--white);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .navbar-brand img {
      max-height: 45px;
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg px-4 py-3">
  <a class="navbar-brand" href="CRMPAGE1"><img src="logo-horizontal.png" alt="Logo"></a>
  <div class="ms-auto d-flex align-items-center gap-3">
    <div class="position-relative">
      <input type="text" id="globalSearch" class="form-control search-input" placeholder="Search brokers, solicitors, customers..." autocomplete="off">
      <div id="searchResults" class="list-group position-absolute w-100 shadow" style="z-index:1000; display:none;"></div>
    </div>

    <div class="dropdown">
      <button class="ellipsis-btn" data-bs-toggle="dropdown">&#8942;</button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="CRMPAGE1.html">Dashboard</a></li>
        <li><a class="dropdown-item" href="Lead.html">Request Terms</a></li>
        <li><a class="dropdown-item" href="Customer.html">Customers</a></li>
        <li><a class="dropdown-item" href="Broker.html">Brokers</a></li>
        <li><a class="dropdown-item" href="Solicitor.html">Solicitors</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item text-danger" href="CRMPAGE1.html" onclick="logout()">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container py-5">

  <!-- LOAN HEADER -->
  <div class="dashboard-card mb-4">
    <div class="d-flex justify-content-between align-items-start mb-3">

      <!-- Left: Image + Company & Borrower -->
    <div class="d-flex align-items-center gap-3">
      <img
        src="loanimage.png"
        alt="Company Logo"
        class="rounded"
        style="width: 100px; height: 100px; object-fit: cover;"
  >
  <div>
    <h1 class="mb-1">Oakwood Developments Ltd</h1>
    <h3 class="mb-0">John Smith</h3>
  </div>
</div>


      <!-- Buttons container -->
    <div class="d-flex gap-2">
      <a href="Files.html" class="btn btn-outline-primary btn-sm">
    <i class="bi bi-file-earmark"></i> Loan Files
  </a>
    </div>

      <!-- Right: Stage Dropdown + % Complete -->
      <div class="stage-dropdown">
        <i class="bi bi-arrow-down-circle-fill"></i>
        <select class="form-select stage-select" id="stageSelect">
          <option value="prospect" selected>Prospect</option>
          <option value="deals">Deals</option>
          <option value="legals">In Legals</option>
          <option value="post">Post Completion</option>
          <option value="live">Live</option>
          <option value="closed">Closed</option>
        </select>
        <span id="percentComplete" class="fw-bold text-muted">0% </span>
      </div>

    </div>

    <!-- Loan info -->
    <div class="row">
      <div class="col-md-3"><div class="text-muted"><strong>Gross loan Amount</strong><br>Â£750,000</div></div>
      <div class="col-md-3"><div class="text-muted"><strong>Security Address</strong><br>45 Bridge Street, Leeds LS1 2AB</div></div>
      <div class="col-md-2"><div class="text-muted"><strong>Loan Type</strong><br>Retained</div></div>
      <div class="col-md-2"><div class="text-muted"><strong>Rate</strong><br>7.25%</div></div>
      <div class="col-md-2"><div class="text-muted"><Strong>Exit</Strong><br>Sale</div></div>
    </div>
    <div class="row">
      <div class="col-md-3"><div class="text-muted"><strong>Property Summary</strong><br>Terrace</div></div>
      <div class="col-md-3"><div class="text-muted"><strong>Bedooms</strong><br>3</div></div>
    </div>
    <br>
    <div class="row">
      <div class="col-md-3">
  <div class="text-muted d-flex align-items-center gap-2">
    <strong>Follow Up Owner</strong>
    <select
      class="form-select form-select-sm border-0 bg-transparent p-0"
      style="width: 160px;"
    >
      <option selected>Paul Waters</option>
      <option>Jack Tolchard</option>
      <option>Justin Beckwith</option>
    </select>
      </div>
</div>

      <div class="col-md-3">
  <div class="text-muted d-flex align-items-center gap-2">
    <strong>Follow Up Date</strong>
    <input
      type="date"
      class="form-control form-control-sm border-0 bg-transparent p-0"
      value="2026-01-09"
      style="width: 130px;"
    >
  </div>
</div>

    </div>
  </div>

  <!-- STAGE TRACKER -->
  <div class="dashboard-card mb-4">
    <div class="row g-2 text-center" id="stageTracker">
      <div class="col stage-step active" data-stage="prospect">Prospect</div>
      <div class="col stage-step" data-stage="deals">Deals</div>
      <div class="col stage-step" data-stage="legals">In Legals</div>
      <div class="col stage-step" data-stage="post">Post Completion</div>
      <div class="col stage-step" data-stage="live">Live</div>
      <div class="col stage-step" data-stage="closed">Closed</div>
    </div>
  </div>

  
  <!-- CHECKLIST -->
  <div class="dashboard-card">
    <h3 id="stageTitle" class="mb-3">Prospect Requirements</h3>
    <div id="checklistContainer"></div>
  </div>
  <br>

  <!-- Notes Box -->
<div class="dashboard-card mb-4">
  <h5 class="mb-3">Notes</h5>

  <!-- Add Note Input -->
  <div class="mb-3">
    <textarea id="noteInput" class="form-control mb-2" rows="3" placeholder="Type your note here..."></textarea>
    <button class="btn btn-success btn-sm" onclick="addNote()">Add Note</button>
  </div>

  <!-- Notes Display -->
  <div id="notesContainer" class="border rounded p-3 bg-light">
    <p class="mb-1 text-muted">
      <strong>Paul Waters - 07/01/2026</strong><br>
      Requested Signed OIP from Broker
    </p>
    <br>
    <p class="mb-1 text-muted">
      <strong>Paul Waters - 05/01/2026</strong><br>
      Sent OIP for signature
    </p>
  </div>
</div>


</div>

<script>
  function addNote() {
    const noteText = document.getElementById("noteInput").value.trim();
    if (!noteText) return;

    const notesContainer = document.getElementById("notesContainer");

    const today = new Date().toLocaleDateString("en-GB");

    const note = document.createElement("p");
    note.className = "mb-1 text-muted";
    note.innerHTML = `<strong>Paul Waters - ${today}</strong><br>${noteText}`;

    notesContainer.prepend(note);
    notesContainer.prepend(document.createElement("br"));

    document.getElementById("noteInput").value = "";
  }
</script>

<script>
  const stageData = {
    prospect: { title: "Prospect Requirements", items: ["OIP Sent"] },
    deals: { title: "Deals Requirements", items: ["OIP Signed","Sizer Created","Application Form","Identity Check","Toorak Instructed"] },
    legals: { title: "In Legals Requirements", items: [
      "Instruction Letter to Field Fisher","Bank Statement (Deposit)","Right to Remain","Valuation Complete",
      "Borrower CV (if works funds)","A&L","Exit Plan","Credit Report","Building Insurance",
      "Schedule of Works (if applicable)","Signed Security Documents","Report on Title (ROT)","Direct Debit Signed (If Interest Serviced)",
      "Land Reg","Monitoring Survey Requested","Monitoring Survey Received","Monitoring Survey Received","Facilities Letter Approved"
    ]},
    post: { title: "Post Completion Requirements", items: ["Funds Released","Charge Registered","Evidence of Registered Charge","Final FF Completion Statement","Signed & Dated Security Docs","Final Signed RoT"] },
    live: { title: "Live Requirements", items: ["Ongoing"] },
    closed: { title: "Closed", items: ["Loan Fully Repaid"] }
  };

  const checklistContainer = document.getElementById("checklistContainer");
  const stageTitle = document.getElementById("stageTitle");
  const stageSteps = document.querySelectorAll(".stage-step");
  const stageSelect = document.getElementById("stageSelect");
  const percentDisplay = document.getElementById("percentComplete");

  function updatePercentComplete() {
    const checkboxes = checklistContainer.querySelectorAll("input[type='checkbox']");
    const total = checkboxes.length;
    if (total === 0) { percentDisplay.innerText = "0% Complete"; return; }
    let checked = 0;
    checkboxes.forEach(cb => { if(cb.checked) checked++; });
    const percent = Math.round((checked / total) * 100);
    percentDisplay.innerText = percent + "% ";
  }

  function loadStage(stageKey) {
    const stage = stageData[stageKey];
    stageTitle.innerText = stage.title;
    checklistContainer.innerHTML = "";

    if(stageKey === "legals") {
      checklistContainer.innerHTML = `<div class="row g-2"></div>`;
      const row = checklistContainer.querySelector(".row");
      stage.items.forEach(item => {
        row.innerHTML += `<div class="col-md-4"><div class="checklist-item"><input type="checkbox" class="form-check-input"><div>${item}</div></div></div>`;
      });
    } else {
      stage.items.forEach(item => {
        checklistContainer.innerHTML += `<div class="checklist-item"><input type="checkbox" class="form-check-input"><div>${item}</div></div>`;
      });
    }

    // Add checkbox listeners for % complete
    checklistContainer.querySelectorAll("input[type='checkbox']").forEach(cb => {
      cb.addEventListener("change", updatePercentComplete);
    });
    updatePercentComplete();

    // Update stage tracker buttons
    stageSteps.forEach(step => { step.classList.remove("active"); });
    stageSteps.forEach(step => { if(step.dataset.stage === stageKey) step.classList.add("active"); });

    // Update dropdown
    stageSelect.value = stageKey;
  }

  stageSteps.forEach(step => {
    step.addEventListener("click", () => { loadStage(step.dataset.stage); });
  });

  stageSelect.addEventListener("change", () => { loadStage(stageSelect.value); });

  // Initial load
  loadStage("live");
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


